<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BuildTrace AI - Drawing Comparison</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1 class="logo">BuildTrace AI</h1>
            <p class="tagline">Intelligent Drawing Comparison & Analysis</p>
        </header>

        <!-- Progress Steps -->
        <div class="progress-steps">
            <div class="step active" id="step-1">
                <div class="step-number">1</div>
                <span>Upload Old</span>
            </div>
            <div class="step" id="step-2">
                <div class="step-number">2</div>
                <span>Upload New</span>
            </div>
            <div class="step" id="step-3">
                <div class="step-number">3</div>
                <span>Process</span>
            </div>
            <div class="step" id="step-4">
                <div class="step-number">4</div>
                <span>Results</span>
            </div>
        </div>

        <!-- Main Upload Interface -->
        <div class="upload-section">
            <form id="upload-form" enctype="multipart/form-data">
                <div class="upload-panels">
                    <!-- Old Drawing Upload -->
                    <div class="upload-panel">
                        <h3>Baseline Drawing (Old)</h3>
                        <div class="upload-area" id="old-upload-area">
                            <div class="upload-icon">ðŸ“„</div>
                            <p>Drag & drop your baseline drawing here</p>
                            <p class="upload-subtext">or click to browse</p>
                            <input type="file" id="old-file" name="old_file" accept=".pdf,.dwg,.dxf,.png,.jpg,.jpeg" style="display: none;">
                        </div>
                        <div class="file-info" id="old-file-info" style="display: none;">
                            <div class="file-name"></div>
                            <div class="file-size"></div>
                            <button type="button" class="remove-file" onclick="removeFile('old')">Ã—</button>
                        </div>
                        <p class="file-formats">Supported: PDF, DWG, DXF, PNG, JPG (Max 70MB)</p>
                    </div>

                    <!-- New Drawing Upload -->
                    <div class="upload-panel">
                        <h3>Revised Drawing (New)</h3>
                        <div class="upload-area" id="new-upload-area">
                            <div class="upload-icon">ðŸ“„</div>
                            <p>Drag & drop your revised drawing here</p>
                            <p class="upload-subtext">or click to browse</p>
                            <input type="file" id="new-file" name="new_file" accept=".pdf,.dwg,.dxf,.png,.jpg,.jpeg" style="display: none;">
                        </div>
                        <div class="file-info" id="new-file-info" style="display: none;">
                            <div class="file-name"></div>
                            <div class="file-size"></div>
                            <button type="button" class="remove-file" onclick="removeFile('new')">Ã—</button>
                        </div>
                        <p class="file-formats">Supported: PDF, DWG, DXF, PNG, JPG (Max 70MB)</p>
                    </div>
                </div>

                <!-- Compare Button -->
                <div class="compare-section">
                    <button type="submit" id="compare-btn" class="compare-btn" disabled>
                        Compare Drawings
                    </button>
                </div>
            </form>
        </div>

        <!-- Processing Status -->
        <div class="processing-section" id="processing-section" style="display: none;">
            <div class="processing-spinner"></div>
            <h3>Processing Your Drawings...</h3>
            <p id="processing-status">Uploading files...</p>
            <div class="processing-steps">
                <div class="processing-step" id="proc-upload">
                    <span class="check">âœ“</span> Files uploaded
                </div>
                <div class="processing-step" id="proc-extract">
                    <span class="spinner-small"></span> Extracting drawing names
                </div>
                <div class="processing-step" id="proc-convert">
                    <span class="spinner-small"></span> Converting to images
                </div>
                <div class="processing-step" id="proc-align">
                    <span class="spinner-small"></span> Aligning drawings
                </div>
                <div class="processing-step" id="proc-analyze">
                    <span class="spinner-small"></span> AI analysis
                </div>
            </div>
        </div>
    </div>

    <!-- Previous Comparisons Section -->
    <div class="container" style="margin-top: 40px; margin-bottom: 40px;">
        <div class="previous-comparisons-section">
            <h2 style="margin-bottom: 20px; color: #1e293b;">Recent Comparisons</h2>
            <div id="recent-comparisons-list" class="comparisons-grid">
                <!-- Will be populated by JavaScript -->
                <div class="loading-placeholder" style="text-align: center; padding: 40px;">
                    <p style="color: #64748b;">Loading recent comparisons...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Use modular app architecture -->
    <script type="module" src="{{ url_for('static', filename='js/app-modular.js') }}"></script>

    <style>
        /* Recent Comparisons Table Styling */
        .sessions-table-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            margin-top: 20px;
        }

        .sessions-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .sessions-table thead th {
            background: #f8fafc;
            color: #374151;
            font-weight: 600;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sessions-table tbody td {
            padding: 12px 16px;
            border-bottom: 1px solid #f1f5f9;
            vertical-align: middle;
        }

        .sessions-table tbody tr:hover {
            background: #f8fafc;
        }

        .sessions-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Column specific styling */
        .date-col {
            width: 15%;
            color: #64748b;
            font-weight: 500;
        }

        .baseline-col, .revised-col {
            width: 20%;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Roboto Mono', monospace;
            font-size: 0.85rem;
        }

        .changes-col {
            width: 10%;
            text-align: center;
        }

        .status-col {
            width: 15%;
        }

        .actions-col {
            width: 20%;
            text-align: center;
        }

        /* Status badges */
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-completed {
            background: #dcfce7;
            color: #166534;
        }

        .status-processing {
            background: #fef3c7;
            color: #92400e;
        }

        .status-failed, .status-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .status-in-progress {
            background: #dbeafe;
            color: #1e40af;
        }

        /* Changes display */
        .changes-count {
            font-weight: 600;
            color: #059669;
        }

        .no-changes {
            color: #64748b;
        }

        .processing-text {
            color: #92400e;
            font-style: italic;
        }

        .error-text {
            color: #991b1b;
            font-weight: 500;
        }

        /* Action buttons */
        .action-btn {
            background: none;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            padding: 6px 8px;
            margin: 0 2px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .action-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .view-btn {
            color: #3b82f6;
        }

        .view-btn:hover {
            background: #eff6ff;
            border-color: #3b82f6;
        }

        .delete-btn {
            color: #ef4444;
        }

        .delete-btn:hover {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Empty state */
        .empty-comparisons {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        .empty-comparisons-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .sessions-table-container {
                overflow-x: auto;
            }

            .sessions-table {
                min-width: 600px;
            }

            .baseline-col, .revised-col {
                font-size: 0.75rem;
            }

            .sessions-table thead th,
            .sessions-table tbody td {
                padding: 8px 12px;
            }

            .action-btn {
                padding: 4px 6px;
            }
        }

        @media (max-width: 480px) {
            .sessions-table {
                min-width: 500px;
            }

            .date-col {
                width: 12%;
            }

            .baseline-col, .revised-col {
                width: 18%;
            }

            .changes-col {
                width: 8%;
            }

            .status-col {
                width: 12%;
            }

            .actions-col {
                width: 32%;
            }
        }

        /* Loading spinner for delete actions */
        .spinner-small {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid #f3f3f3;
            border-radius: 50%;
            border-top-color: #6b7280;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
    </style>
</body>
</html>